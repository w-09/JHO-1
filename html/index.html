<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>南一處-亞灣工務所</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            padding-top: 60px;
            padding-bottom: 70px;
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #1a73e8;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 800px;
        }
        
        .header-logo {
            height: 40px;
            margin-right: 10px;
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 500;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #1a73e8;
            display: flex;
            align-items: center;
        }
        
        h2 .material-icons {
            margin-right: 5px;
            font-size: 20px;
        }
        
        /* 公告欄樣式 */
        .bulletin-entry {
            background-color: #f9f9f9;
            border-left: 5px solid #3e9956;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .bulletin-entry:hover {
            transform: translateX(10px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .loading {
            text-align: center;
            color: #3e9956;
            padding: 20px;
            font-size: 16px;
        }

        .entry-title {
            font-weight: bold;
            color: #2c7a3f;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .entry-content {
            color: #333;
            margin-bottom: 10px;
        }

        .entry-date {
            color: #888;
            text-align: right;
            font-size: 0.8em;
        }
        
        /* 更多按鈕 */
        .view-more-btn {
            display: block;
            text-align: center;
            padding: 10px;
            background-color: #f5f5f5;
            color: #1a73e8;
            border-radius: 5px;
            margin-top: 10px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .view-more-btn:hover {
            background-color: #e0e0e0;
        }
        
        /* 工期倒數計時器 */
        .countdown-timer {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .countdown-timer h3 {
            margin-bottom: 10px;
            color: #1a73e8;
        }
        
        .countdown-timer .timer {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .countdown-timer .time-block {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .countdown-timer .time-value {
            font-size: 24px;
            font-weight: bold;
            background-color: #1a73e8;
            color: white;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
        }
        
        .countdown-timer .time-label {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }
        
        /* 部門按鈕容器樣式 */
        .btn-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            display: block;
            background-color: #1a73e8;
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            text-decoration: none;
            text-align: center;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #1557b0;
        }
        
        /* 錯誤訊息樣式 */
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 10px 0;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            text-decoration: none;
            font-size: 12px;
        }
        
        .nav-item.active {
            color: #1a73e8;
        }
        
        .nav-item i {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        /* 浮動按鈕樣式 */
        .floating-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 99;
        }

        .floating-btn button {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: #1a73e8;
            color: white;
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .floating-btn button:hover {
            background-color: #1557b0;
            transform: scale(1.05);
        }

        .floating-btn .material-icons {
            font-size: 24px;
        }

        /* 彈出視窗樣式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1001;
            overflow: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            width: 90%;
            max-width: 900px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-20px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .modal-header h2 {
            margin: 0;
            color: #1a73e8;
        }

        .close-modal {
            font-size: 28px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
        }

        .close-modal:hover {
            color: #1a73e8;
        }

        /* 標籤頁樣式 */
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            background-color: #f5f5f5;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: #1a73e8;
            border-bottom: 3px solid #1a73e8;
            background-color: white;
        }

        .tab-btn:hover:not(.active) {
            background-color: #e0e0e0;
        }

        .modal-body {
            padding: 0;
            flex: 1;
            overflow: hidden;
        }

        .tab-content {
            display: none;
            height: 100%;
        }

        .tab-content.active {
            display: block;
            height: 100%;
        }

        /* iframe 容器樣式 */
        .iframe-container {
            position: relative;
            height: 60vh;
            width: 100%;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .fullscreen-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255,255,255,0.8);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .fullscreen-btn:hover {
            background-color: white;
            transform: scale(1.1);
        }

        /* 全螢幕模式 */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1002;
            background-color: white;
            padding: 20px;
            box-sizing: border-box;
        }

        .fullscreen-mode iframe {
            width: 100%;
            height: calc(100% - 50px);
        }

        .fullscreen-mode .exit-fullscreen {
            display: block;
            margin-bottom: 10px;
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .fullscreen-mode .exit-fullscreen:hover {
            background-color: #1557b0;
        }
        
        /* 針對小螢幕裝置的響應式調整 */
        @media (max-width: 768px) {
            .btn-container {
                flex-direction: column;
            }
            
            .btn-group {
                width: 100%;
            }
            
            .countdown-timer .timer {
                flex-wrap: wrap;
            }
            
            .countdown-timer .time-value {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .header-logo {
                height: 30px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .tab-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .iframe-container {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <img src="https://i.postimg.cc/ZKWfsQD9/Logo-02-0.png" alt="Logo" class="header-logo">
            <h1>亞灣工地</h1>
        </div>
    </header>
    
    <div class="container">
        <!-- 工期倒數計時器 -->
        <section id="countdown">
            <h2><i class="material-icons">timer</i> 時間快到了</h2>
            <div class="card">
                <div class="countdown-timer">
                    <h3>工程預計完工時間</h3>
                    <div class="timer">
                        <div class="time-block">
                            <div id="days" class="time-value">00</div>
                            <div class="time-label">天</div>
                        </div>
                        <div class="time-block">
                            <div id="hours" class="time-value">00</div>
                            <div class="time-label">時</div>
                        </div>
                        <div class="time-block">
                            <div id="minutes" class="time-value">00</div>
                            <div class="time-label">分</div>
                        </div>
                        <div class="time-block">
                            <div id="seconds" class="time-value">00</div>
                            <div class="time-label">秒</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 公告欄直接顯示在首頁 -->
        <section id="bulletin">
            <h2><i class="material-icons">campaign</i> 最新公告</h2>
            <div class="card">
                <div id="bulletin-entries" class="loading">
                    載入公告中...
                </div>
                <a href="#" id="view-more-btn" class="view-more-btn" style="display:none;">
                    查看更多公告
                </a>
            </div>
        </section>
        
        <section id="departments">
            <h2><i class="material-icons">business</i> 各組連結</h2>
            <div class="card">
                <div class="btn-container">
                    <div class="btn-group">
                        <p style="color: #1a73e8; font-size: 18px; margin-bottom: 10px;">施工組</p>
                        <a href="https://docs.google.com/spreadsheets/d/1_jZbDPtyy7cO3cA0VwdrQGD6sbkIz0tzjLnnktIbVFw/edit?gid=0#gid=0" class="btn">機關日報</a>
                        <a href="https://docs.google.com/spreadsheets/d/1BxXg5jEgVMVnT5uBZGIEUoEs7GHX90Aent1j9mCZWD8/edit?gid=0#gid=0" class="btn">施工自主查驗</a>
                        <a href="https://docs.google.com/spreadsheets/d/1JaZEKyh_M6bWk_I3p-jWH1cL6htITDyfzwwzSb3mbcc/edit?gid=442371140#gid=442371140" class="btn">混凝土澆置統計</a>
                        <a href="https://docs.google.com/spreadsheets/d/1LtNOr7zsmdIlIMaf4jUn77W6LCdlxh3rcCXPcvXafkw/edit?gid=0#gid=0" class="btn">缺失改善紀錄</a>
                        <a href="https://docs.google.com/spreadsheets/d/1QP7HbrNo5MCdGsvQsY1hUy2ufkkg3hwsgfDL917FkBo/edit?gid=0#gid=0" class="btn">施工進度取線圖</a>
                        <a href="https://w-09.github.io/form/Untitled-1.html" class="btn">每日進場人數回報</a>
                        <a href="https://docs.google.com/spreadsheets/d/14bCNRHbODeUyE_SoTtciLrtRKutp8AFP7W0S_KJQPPg/edit?gid=250419685#gid=250419685" class="btn">施工圖圖控</a>
                    </div>
                    <div class="btn-group">
                        <p style="color: #1a73e8; font-size: 18px; margin-bottom: 10px;">品管組</p>
                        <a href="https://docs.google.com/spreadsheets/d/13dLwyMfSB_O8V2oHDqnUeV__RnNFalBGPllYWnyXaPw/edit?gid=0#gid=0" class="btn">混凝土澆置時間紀錄(1)</a>
                        <a href="https://docs.google.com/spreadsheets/d/120XZPrVJ45FkId1PKj4Weov0lcDOhBsThOSnPlg3A3A/edit?usp=sharing" class="btn">混凝土澆置時間紀錄(2)</a>
                        <a href="https://docs.google.com/spreadsheets/d/1ymHlbXo8yzJ8XCd9djMdBSwjwIqwsGdUfdDd4OE8nio/edit?gid=281744822#gid=281744822" class="btn">收/發文紀錄</a>
                        <a href="https://docs.google.com/spreadsheets/d/13Zf7l9bKjapzaQGxyRAc-qeVmdWNmFhGxPd2ziPnEJw/edit?gid=0#gid=0" class="btn">工程相關人員督導紀錄</a>
                        <a href="https://docs.google.com/spreadsheets/d/1i1TBepz7SEm0KRRCbRYntfTcCA7ZKUgRRwDaWJ1nMqU/edit?gid=1342178985#gid=1342178985" class="btn">矯正預防/永青自主缺失統計</a>
                        <a href="https://docs.google.com/spreadsheets/d/1MK7jePCQ2Yjm26yTVvdctfMCOfXwiGLiSxy-LPc3ERc/edit?gid=1616629558#gid=1616629558" class="btn">材料設備統計表/申請單</a>
                        <a href="https://docs.google.com/spreadsheets/d/1VSqgrKHe_KrP5BHJQ6HIQPMPAN5njZ1Klte9S6x9TSA/edit?gid=656392846#gid=656392846" class="btn">鋼筋進場統計</a>
                        <a href="https://docs.google.com/spreadsheets/d/15upHRzj2BciKvpJaTAXYmYF9JkKQIyGE5iJFfRYFCm8/edit?gid=1766218997#gid=1766218997" class="btn">管制總表</a>
                    </div>
                    <div class="btn-group">
                        <p style="color: #1a73e8; font-size: 18px; margin-bottom: 10px;">行政組</p>
                        <a href="https://docs.google.com/spreadsheets/d/1DZa-5tN-KdqLg9TXe-YYKJ-qjJl5MB5bF_MU0RCj_iY/edit?gid=0#gid=0" class="btn">亞灣通訊錄</a>
                        <a href="https://docs.google.com/spreadsheets/d/1kBVdvBb7IxcNXlKKfV0XHAN1SzuaHmAR9ndvdUEK7Tg/edit?gid=0#gid=0" class="btn">公告管理表</a>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- 浮動按鈕 -->
    <div class="floating-btn">
        <button id="statsButton">
            <i class="material-icons">bar_chart</i>
        </button>
    </div>

    <!-- 統計表彈出視窗 -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>統計表</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="construction">施工統計表</button>
                <button class="tab-btn" data-tab="material">材料統計表</button>
            </div>
            <div class="modal-body">
                <div id="construction" class="tab-content active">
                    <div class="iframe-container">
                        <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQDM8CixCezA76NPFE5oejTPTgoBrQMW3ySWxZNTYTVSJQD_LPR4aP61h8YHshqVMazDPVp4BAFnz2u/pubchart?oid=53990740&format=interactive" frameborder="0"></iframe>
                        <button class="fullscreen-btn" data-iframe="construction">
                            <i class="material-icons">fullscreen</i>
                        </button>
                    </div>
                </div>
                <div id="material" class="tab-content">
                    <div class="iframe-container">
                        <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRiqFj7dalIGRMp6k7lLPpQdZxsq3FZ4YDQpCjWgYpALThZtVoQlkm5CX3nAODOx-TklA7AP4WAfWHK/pubchart?oid=7002305&format=interactive" frameborder="0"></iframe>
                        <button class="fullscreen-btn" data-iframe="material">
                            <i class="material-icons">fullscreen</i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <i class="material-icons">home</i>
            <span>首頁</span>
        </a>
        <a href="#bulletin" class="nav-item">
            <i class="material-icons">campaign</i>
            <span>公告</span>
        </a>
        <a href="#" class="nav-item">
            <i class="material-icons">description</i>
            <span>文件(尚未開發)</span>
        </a>
        <a href="#" class="nav-item">
            <i class="material-icons">person</i>
            <span>個人(尚未開發)</span>
        </a>
    </nav>
    
    <script>
        // Google試算表的公開發佈CSV網址
        const SPREADSHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRC4HgLq2IE7lKm4lixBvo0X4f6Erl6JdW6prqkrr83AypmGiwfnUCyCFXcoN_KfNbGCvUu5u6vHXp5/pub?output=csv';
        
        // 工期倒數計時器
        function updateCountdown() {
            // 設定目標日期 (2026年12月25日)
            const targetDate = new Date('2026-12-25T00:00:00');
            const currentDate = new Date();
            
            // 計算剩餘時間
            const timeLeft = targetDate - currentDate;
            
            // 如果已經過了目標日期
            if (timeLeft <= 0) {
                document.getElementById('days').textContent = '00';
                document.getElementById('hours').textContent = '00';
                document.getElementById('minutes').textContent = '00';
                document.getElementById('seconds').textContent = '00';
                return;
            }
            
            // 計算天、時、分、秒
            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            // 更新顯示
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }
        
        // 每秒更新一次倒數計時
        updateCountdown();
        setInterval(updateCountdown, 1000);
        
        // 頁面載入時直接獲取公告
        document.addEventListener('DOMContentLoaded', function() {
            fetchBulletinEntries();
            
            // 浮動按鈕和彈出視窗功能
            // 獲取元素
            const statsButton = document.getElementById('statsButton');
            const statsModal = document.getElementById('statsModal');
            const closeModal = document.querySelector('.close-modal');
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const fullscreenBtns = document.querySelectorAll('.fullscreen-btn');
            
            // 打開彈出視窗
            statsButton.addEventListener('click', function() {
                statsModal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // 防止背景滾動
            });
            
            // 關閉彈出視窗
            closeModal.addEventListener('click', function() {
                statsModal.style.display = 'none';
                document.body.style.overflow = ''; // 恢復背景滾動
            });
            
            // 點擊彈出視窗外部關閉
            window.addEventListener('click', function(event) {
                if (event.target === statsModal) {
                    statsModal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });
            
            // 標籤頁切換功能
            tabBtns.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    // 移除
